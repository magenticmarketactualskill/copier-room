@startuml Copier-Room Core Class Diagram

!define INTERFACE_COLOR #BBDEFB
!define CORE_COLOR #E8F5E9
!define ADAPTER_COLOR #FFF9C4
!define MODEL_COLOR #F3E5F5

skinparam class {
    BackgroundColor<<interface>> INTERFACE_COLOR
    BorderColor<<interface>> #2196F3
    BackgroundColor<<core>> CORE_COLOR
    BorderColor<<core>> #4CAF50
    BackgroundColor<<adapter>> ADAPTER_COLOR
    BorderColor<<adapter>> #FFC107
    BackgroundColor<<model>> MODEL_COLOR
    BorderColor<<model>> #9C27B0
}

package "Port Interfaces" {
    interface IJsonRpcLdPort <<interface>> {
        +handleRequest(request: JsonRpcLdRequest): JsonRpcLdResponse
        +validateRequest(request: JsonRpcLdRequest): ValidationResult
        +getMethodSchema(methodName: string): ShacLShape
    }
    
    interface IContentGenerationPort <<interface>> {
        +generateComponent(spec: ComponentSpec): GeneratedContent
        +composeContent(templates: Template[]): ComposedContent
    }
    
    interface IVersionControlPort <<interface>> {
        +commit(changes: ChangeSet): CommitInfo
        +getHistory(path: string): History[]
        +branch(name: string): Branch
    }
}

package "Core Domain" {
    class FunctionChainProcessor <<core>> {
        -chainDefinition: FunctionChain
        -context: ExecutionContext
        +processChain(input: any): ChainResult
        +loadChainFromConfig(config: CopierRoomConfig): FunctionChain
        -executeFunction(func: Function, input: any): any
        -applyMethodChaining(functions: Function[]): any
    }
    
    class TemplateResolver <<core>> {
        -functionalRepo: FunctionalRepository
        -contextualRepo: ContextualRepository
        -compositionalRepo: CompositionalRepository
        +resolveTemplate(spec: TemplateSpec): Template
        +queryFunctional(path: string): Template[]
        +queryContextual(context: Context): Template[]
        +queryCompositional(role: string): Template[]
    }
    
    class ContentComposer <<core>> {
        -transformers: Transformer[]
        +compose(templates: Template[], data: any): ComposedContent
        +applyTransformations(content: Content): Content
        -mergeTemplates(templates: Template[]): MergedTemplate
        -injectData(template: Template, data: any): Content
    }
    
    class GitEngine <<core>> {
        -repository: GitRepository
        -commitStrategy: CommitStrategy
        +initRepository(path: string): void
        +trackChanges(files: File[]): ChangeSet
        +commit(changeSet: ChangeSet, message: string): CommitInfo
        +getVersion(path: string): Version
    }
    
    class CopierRoomConfig <<model>> {
        -functionReferences: FunctionReference[]
        -metadata: ConfigMetadata
        +load(path: string): CopierRoomConfig
        +getFunctionChain(): FunctionReference[]
        +validate(): ValidationResult
    }
    
    class OntologicalStorage <<core>> {
        -functionalPath: string
        -contextualPath: string
        -compositionalPath: string
        +queryByFunction(functionPath: string): StorageItem[]
        +queryByContext(context: Context): StorageItem[]
        +queryByRole(role: string): StorageItem[]
        +store(item: StorageItem): void
    }
}

package "Adapters" {
    class RailsClientAdapter <<adapter>> {
        -jsonRpcClient: JsonRpcLdClient
        -railsContext: RailsContext
        +generateView(params: RailsParams): RailsView
        +generateController(params: RailsParams): RailsController
        +generateModel(params: RailsParams): RailsModel
        -translateToJsonRpcLd(params: RailsParams): JsonRpcLdRequest
        -translateFromJsonRpcLd(response: JsonRpcLdResponse): RailsComponent
    }
    
    class DjangoClientAdapter <<adapter>> {
        -jsonRpcClient: JsonRpcLdClient
        -djangoContext: DjangoContext
        +generateView(params: DjangoParams): DjangoView
        +generateTemplate(params: DjangoParams): DjangoTemplate
        +generateModel(params: DjangoParams): DjangoModel
        -translateToJsonRpcLd(params: DjangoParams): JsonRpcLdRequest
        -translateFromJsonRpcLd(response: JsonRpcLdResponse): DjangoComponent
    }
    
    class LaravelClientAdapter <<adapter>> {
        -jsonRpcClient: JsonRpcLdClient
        -laravelContext: LaravelContext
        +generateView(params: LaravelParams): LaravelView
        +generateController(params: LaravelParams): LaravelController
        +generateModel(params: LaravelParams): LaravelModel
        -translateToJsonRpcLd(params: LaravelParams): JsonRpcLdRequest
        -translateFromJsonRpcLd(response: JsonRpcLdResponse): LaravelComponent
    }
    
    class JsonRpcLdClient <<adapter>> {
        -endpoint: string
        -contextProvider: ContextProvider
        +call(method: string, params: any): JsonRpcLdResponse
        +addContext(params: any): JsonRpcLdParams
        -validateResponse(response: JsonRpcLdResponse): boolean
    }
}

package "Domain Models" {
    class JsonRpcLdRequest <<model>> {
        +jsonrpc: string
        +method: string
        +params: JsonRpcLdParams
        +id: string | number
    }
    
    class JsonRpcLdParams <<model>> {
        +@context: JsonLdContext
        +@type: string
        +[key: string]: any
    }
    
    class JsonRpcLdResponse <<model>> {
        +jsonrpc: string
        +result: JsonRpcLdResult
        +id: string | number
    }
    
    class Template <<model>> {
        +path: string
        +content: string
        +metadata: TemplateMetadata
        +variables: Variable[]
    }
    
    class ComponentSpec <<model>> {
        +componentType: string
        +platform: string
        +framework: string
        +customization: any
    }
    
    class FunctionChain <<model>> {
        +functions: FunctionReference[]
        +execute(input: any): any
    }
}

' Relationships - Port Implementations
FunctionChainProcessor ..|> IJsonRpcLdPort
ContentComposer ..|> IContentGenerationPort
GitEngine ..|> IVersionControlPort

' Relationships - Core Dependencies
FunctionChainProcessor --> TemplateResolver : uses
FunctionChainProcessor --> ContentComposer : uses
FunctionChainProcessor --> GitEngine : uses
FunctionChainProcessor --> CopierRoomConfig : reads
TemplateResolver --> OntologicalStorage : queries
ContentComposer --> Template : processes

' Relationships - Adapter Dependencies
RailsClientAdapter --> JsonRpcLdClient : uses
DjangoClientAdapter --> JsonRpcLdClient : uses
LaravelClientAdapter --> JsonRpcLdClient : uses
JsonRpcLdClient --> IJsonRpcLdPort : calls
JsonRpcLdClient --> JsonRpcLdRequest : creates
JsonRpcLdClient --> JsonRpcLdResponse : receives

' Relationships - Model Dependencies
JsonRpcLdRequest --> JsonRpcLdParams : contains
FunctionChainProcessor --> FunctionChain : executes
ContentComposer --> ComponentSpec : uses

note right of IJsonRpcLdPort
  **Primary Port**
  Defines the contract for
  JSON-RPC-LD communication
  with semantic validation
end note

note bottom of OntologicalStorage
  **Three-Tier Storage**
  - Functional: organized by purpose
  - Contextual: organized by platform/framework
  - Compositional: organized by role
end note

note left of RailsClientAdapter
  **Framework Adapters**
  Translate between framework-specific
  conventions and JSON-RPC-LD protocol
end note

@enduml
